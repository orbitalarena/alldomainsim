<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>All-Domain Simulation - Orbit Viewer</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        html, body, #cesiumContainer {
            width: 100%; height: 100%; margin: 0; padding: 0; overflow: hidden;
        }
        #controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(42, 42, 42, 0.9);
            padding: 15px;
            border-radius: 5px;
            color: white;
            font-family: sans-serif;
            z-index: 1000;
        }
        #controls h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        #controls button {
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            background: #2196F3;
            border: none;
            border-radius: 3px;
            color: white;
            font-size: 14px;
        }
        #controls button:hover {
            background: #1976D2;
        }
        #status {
            margin-top: 10px;
            font-size: 12px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <div id="controls">
        <h3>üõ∞Ô∏è All-Domain Simulation</h3>
        <button onclick="loadOrbitData()">Load Orbit Data</button>
        <button onclick="resetView()">Reset View</button>
        <div id="status">Ready to load orbit data...</div>
    </div>
    <div id="cesiumContainer"></div>

    <script>
        // Initialize Cesium viewer
        const viewer = new Cesium.Viewer('cesiumContainer', {
            terrainProvider: Cesium.createWorldTerrain(),
            animation: false,
            timeline: false,
            baseLayerPicker: false,
        });

        let orbitEntities = [];

        function resetView() {
            viewer.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(0, 0, 15000000),
                orientation: {
                    heading: 0,
                    pitch: -Cesium.Math.PI_OVER_TWO,
                    roll: 0
                }
            });
        }

        async function loadOrbitData() {
            const status = document.getElementById('status');
            status.textContent = 'Loading orbit data...';

            try {
                // Load the orbit JSON file
                const response = await fetch('../../orbit_data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Clear existing entities
                orbitEntities.forEach(entity => viewer.entities.remove(entity));
                orbitEntities = [];

                // Process each satellite
                data.satellites.forEach((satellite, idx) => {
                    const positions = [];
                    const colors = [
                        Cesium.Color.RED,
                        Cesium.Color.YELLOW,
                        Cesium.Color.GREEN,
                        Cesium.Color.CYAN,
                        Cesium.Color.BLUE,
                        Cesium.Color.MAGENTA,
                        Cesium.Color.WHITE,
                        Cesium.Color.ORANGE
                    ];
                    const color = colors[idx % colors.length];

                    // Convert ECI positions to Cesium Cartesian3
                    satellite.positions.forEach(pos => {
                        positions.push(new Cesium.Cartesian3(pos.x, pos.y, pos.z));
                    });

                    // Create polyline for orbit path
                    const entity = viewer.entities.add({
                        name: satellite.name,
                        polyline: {
                            positions: positions,
                            width: 2,
                            material: color,
                            clampToGround: false
                        },
                        // Add a point at the final position
                        point: {
                            pixelSize: 10,
                            color: color,
                            outlineColor: Cesium.Color.WHITE,
                            outlineWidth: 2
                        },
                        position: positions[positions.length - 1],
                        label: {
                            text: satellite.name,
                            font: '14px sans-serif',
                            fillColor: Cesium.Color.WHITE,
                            outlineColor: Cesium.Color.BLACK,
                            outlineWidth: 2,
                            style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                            pixelOffset: new Cesium.Cartesian2(0, -12)
                        }
                    });

                    orbitEntities.push(entity);
                });

                status.textContent = `Loaded ${data.satellites.length} satellites with ${data.satellites[0].positions.length} points each`;
                
                // Zoom to show all satellites
                if (orbitEntities.length > 0) {
                    viewer.zoomTo(viewer.entities);
                }

            } catch (error) {
                status.textContent = `Error: ${error.message}`;
                console.error('Error loading orbit data:', error);
            }
        }

        // Initial view
        resetView();

        // Try to load data automatically
        setTimeout(loadOrbitData, 500);
    </script>
</body>
</html>
